<!DOCTYPE html>
<html>

<head>
    <title>Live Voting Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Poppins', 'Roboto', sans-serif;
            background: linear-gradient(120deg, #101522, #2c3e50, #1f2b38);
            /* Updated gradient based on first theme */
            color: #e3e8f5;
            /* Light text color similar to the first theme */
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #00d9ff;
            /* Changed heading color to match first theme */
            text-shadow: 0 0 10px rgba(0, 217, 255, 0.4);
            /* Lighten the glow with theme color */
            font-weight: 700;
            letter-spacing: 0.8px;
        }

        .summary {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .box {
            padding: 20px 25px;
            border-radius: 12px;
            background: rgba(35, 36, 58, 0.95);
            box-shadow: 0 2px 8px rgba(0, 255, 255, 0.1), 0 4px 12px rgba(130, 104, 255, 0.1);
            /* Updated shadow */
            text-align: center;
            width: 180px;
            font-size: 16px;
            font-weight: 600;
            color: #e3e8f5;
            /* Light text color */
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .box:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0, 255, 255, 0.15), 0 6px 18px rgba(130, 104, 255, 0.1);
        }

        .bjp {
            background: rgba(255, 204, 0, 0.85);
            color: #1a1a1a;
        }

        .congress {
            background: rgba(30, 144, 255, 0.85);
            color: #e3e8f5;
            /* Light text color */
        }

        .aap {
            background: rgba(0, 188, 212, 0.85);
            color: #e3e8f5;
            /* Light text color */
        }

        .others {
            background: rgba(142, 68, 173, 0.85);
            color: #e3e8f5;
            /* Light text color */
        }

        .charts {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
        }

        .chart-card {
            background: rgba(35, 36, 58, 0.95);
            padding: 20px;
            border-radius: 14px;
            box-shadow: 0 4px 15px rgba(0, 255, 255, 0.1), 0 6px 18px rgba(166, 108, 255, 0.1);
            width:600px;
            /* Fixed width for consistency */
            height: 400px;
            /* Fixed height for consistency */
            max-width: 100%;
            color: #ffffff;
            transition: box-shadow 0.3s, transform 0.3s;
            position: relative;
        }

        .chart-card:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 20px rgba(0, 255, 255, 0.1), 0 8px 25px rgba(166, 108, 255, 0.1);
        }

        canvas {
            width: 100% !important;
            /* Ensure canvas fills the container */
            height: 100% !important;
            /* Ensure canvas height is consistent with the container */
        }

        .donut-card canvas {
            height: 100% !important;
            /* Adjust height for donut chart */
        }

        #partyChartCard {
            max-width: 600px;
            /* Fixed width for party chart */
            width: 100%;
            height: 400px;
        }
        #partyChart{
            height: 600px;
            width:100%;
        }


        .voting-box {
            padding: 20px;
            border-radius: 12px;
            background: rgba(35, 36, 58, 0.95);
            box-shadow: 0 2px 8px rgba(0, 255, 255, 0.1), 0 4px 12px rgba(130, 104, 255, 0.1);
            text-align: center;
            width: 180px;
            font-size: 16px;
            font-weight: 600;
            color: #e3e8f5;
            /* Light text color */
            transition: transform 0.3s, box-shadow 0.3s;
            margin: 15px;
        }

        .voting-box:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0, 255, 255, 0.15), 0 6px 18px rgba(130, 104, 255, 0.1);
        }

        @media (max-width: 768px) {
            .chart-card {
                width: 100%;
                height: 300px;
                /* Adjust height for smaller screens */
            }
        }
        
    </style>
</head>

<body>
    <h1>Live Voting Dashboard</h1>
    


    <div class="summary">
        <div class="box bjp" id="bjpBox">BJP: 0</div>
        <div class="box congress" id="congressBox">Congress: 0</div>
        <div class="box aap" id="aapBox">AAP: 0</div>
        <div class="box others" id="othersBox">Others: 0</div>
    </div>

    <div class="summary">
        <div class="box" id="totalVotes">Total Votes: 0</div>
        <div class="box" id="uniqueVoters">Unique Voters: 0</div>
    </div>
    <div class="card mt-4">
        <h5>Insights Summary</h5>
        <div id="insights">Loading insights...</div> <!-- ðŸ‘ˆ This id must match -->
    </div>
    <div class="charts">
        <div class="chart-card">
            <h3 style="text-align:center;">Votes by State</h3>
            <canvas id="stateChart"></canvas>
        </div>

        <div class="chart-card">
            <h3 style="text-align:center;">Votes by City</h3>
            <canvas id="cityChart"></canvas>
        </div>

        <div class="chart-card" id="partyChartCard">
            <h3 style="text-align:center;">Vote Share by Party</h3>
            <canvas id="partyChart"></canvas>
        </div>


    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            fetch('/data')
                .then(response => response.json())
                .then(data => {
                    const insightsBox = document.getElementById("insights");
                    if (insightsBox) {
                        if (data.insights && data.insights.length > 0) {
                            insightsBox.innerHTML = data.insights.map(i => `ðŸ’¡ ${i}`).join("<br>");
                        } else {
                            insightsBox.innerHTML = "No insights available yet.";
                        }
                    } else {
                        console.warn("No element with ID 'insights' found!");
                    }
                });
        });


        let stateChart, cityChart, partyChart;

        async function fetchData() {
            const res = await fetch('/data');
            const data = await res.json();

            document.getElementById('totalVotes').innerText = `Total Votes: ${data.total_votes}`;
            document.getElementById('uniqueVoters').innerText = `Unique Voters: ${data.unique_voters}`;

            // Update party vote boxes
            document.getElementById('bjpBox').innerText = `BJP: ${data.party_counts.BJP || 0}`;
            document.getElementById('congressBox').innerText = `CONGRESS: ${data.party_counts.Congress || 0}`;
            document.getElementById('aapBox').innerText = `AAP: ${data.party_counts.AAP || 0}`;

            const totalKnown = (data.party_counts.BJP || 0) + (data.party_counts.Congress || 0) + (data.party_counts.AAP || 0);
            const others = data.total_votes - totalKnown;
            document.getElementById('othersBox').innerText = `Others: ${others}`;

            // State Chart
            const stateLabels = Object.keys(data.state_counts);
            const stateData = Object.values(data.state_counts);
            if (stateChart) stateChart.destroy();
            stateChart = new Chart(document.getElementById('stateChart'), {
                type: 'bar',
                data: {
                    labels: stateLabels,
                    datasets: [{
                        label: 'Votes by State',
                        data: stateData,
                        backgroundColor: 'rgba(75, 192, 192, 0.6)'
                    }]
                },
                options: {
                    layout: {
        padding: 45  // ðŸ‘ˆ reduce padding inside chart
    },
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#333',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            }
                        }
                    },
                }
            });

            // City Chart
            const cityLabels = Object.keys(data.city_counts);
            const cityData = Object.values(data.city_counts);
            if (cityChart) cityChart.destroy();
            cityChart = new Chart(document.getElementById('cityChart'), {
                type: 'bar',
                data: {
                    labels: cityLabels,
                    datasets: [{
                        label: 'Votes by City',
                        data: cityData,
                        backgroundColor: 'rgba(255, 99, 132, 0.6)'
                    }]
                },
                options: {
                    layout: {
        padding: 45  // ðŸ‘ˆ reduce padding inside chart
    },
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#333',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: 'rgb(240, 240, 240)'
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.05)'
                            }
                        },
                        y: {
                            ticks: {
                                color: 'rgb(240, 240, 240)'
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        }
                    },
                    elements: {
                        bar: {
                            borderRadius: 6
                        }
                    }
                }
            });

            const partyLabels = Object.keys(data.party_counts);
            const partyData = Object.values(data.party_counts);
            const partyColors = ['#f39c12', '#2980b9', '#27ae60', '#7f8c8d'];

            if (partyChart) partyChart.destroy();
            partyChart = new Chart(document.getElementById('partyChart'), {
                type: 'doughnut',
                data: {
                    labels: partyLabels,
                    datasets: [{
                        data: partyData,
                        backgroundColor: partyColors
                    }]
                },
                options: {
                    layout: {
        padding: 45// ðŸ‘ˆ reduce padding inside chart
    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Vote Share by Party'
                        }
                    }
                }
            });

        }

        fetchData();
        setInterval(fetchData, 30000);
    </script>
</body>

</html>